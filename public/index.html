<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse - Live Event Sentiment & Tipping</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="min-h-screen flex items-center justify-center">
    <div class="container">
        <div class="card max-w-md mx-auto">
            <div class="text-center mb-6">
                <h1 class="mb-2">Pulse</h1>
                <p class="text-secondary">Real-time event sentiment & micro-tipping</p>
            </div>
            
            <div class="flex flex-col gap-4">
                <button id="createRoomBtn" class="btn btn-primary w-full">
                    Create Room
                </button>
                
                <div class="text-center text-secondary">or</div>
                
                <div class="flex flex-col gap-3">
                    <input 
                        type="text" 
                        id="roomCodeInput" 
                        class="input room-input" 
                        placeholder="Enter room code (e.g., ABC123)"
                        maxlength="6"
                        aria-label="Room code"
                    >
                    <button id="joinRoomBtn" class="btn btn-secondary w-full">
                        Join Room
                    </button>
                </div>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-secondary font-size-sm">
                    Powered by <span class="accent-text">Alien</span> â€¢ One human, one voice
                </p>
            </div>
        </div>
    </div>

    <script src="/js/shared.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const createBtn = document.getElementById('createRoomBtn');
            const joinBtn = document.getElementById('joinRoomBtn');
            const roomInput = document.getElementById('roomCodeInput');
            
            // Create room handler
            createBtn.addEventListener('click', async () => {
                try {
                    const title = prompt('Enter room title:');
                    if (!title) return;
                    
                    const speakerWallet = prompt('Enter speaker wallet address:');
                    if (!speakerWallet) return;
                    
                    // Get identity
                    const identity = await AlienBridge.getIdentity();
                    
                    // Create room
                    const response = await fetch('/api/rooms', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title,
                            hostId: identity.alienId,
                            speakerWallet
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to create room');
                    }
                    
                    const { roomId } = await response.json();
                    
                    // Redirect to host view
                    window.location.href = `/host.html?room=${roomId}`;
                    
                } catch (error) {
                    console.error('Error creating room:', error);
                    showToast('Failed to create room. Please try again.');
                }
            });
            
            // Join room handler
            joinBtn.addEventListener('click', async () => {
                const roomCode = roomInput.value.trim().toUpperCase();
                if (!roomCode) {
                    showToast('Please enter a room code');
                    return;
                }
                
                try {
                    // Verify room exists
                    const response = await fetch(`/api/rooms/${roomCode}`);
                    if (!response.ok) {
                        throw new Error('Room not found');
                    }
                    
                    // Get identity
                    await AlienBridge.getIdentity();
                    
                    // Redirect to attendee view
                    window.location.href = `/attend.html?room=${roomCode}`;
                    
                } catch (error) {
                    console.error('Error joining room:', error);
                    showToast('Room not found. Please check the code and try again.');
                }
            });
            
            // Allow Enter key to join room
            roomInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    joinBtn.click();
                }
            });
            
            // Auto-focus room input when typing
            roomInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
        });
    </script>
</body>
</html>
