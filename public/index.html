<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="min-h-screen flex items-center justify-center landing-page">
    <div class="container container-448 landing-container">
        <div class="text-center">
            <div class="landing-title">PULSE</div>
            <div class="landing-tagline">Real-time audience sentiment for live events</div>
        </div>
        
        <div class="landing-tiles">
            <div class="landing-tile">
                <div class="heading-02">Create a room</div>
                <div class="label-01">Room title</div>
                <input 
                    type="text" 
                    id="roomTitleInput" 
                    class="text-input" 
                    placeholder="Enter room title"
                >
                <button id="createRoomBtn" class="btn-primary">
                    Create room
                </button>
            </div>
            
            <div class="landing-tile">
                <div class="heading-02">Join a room</div>
                <div class="label-01">Room code</div>
                <input 
                    type="text" 
                    id="roomCodeInput" 
                    class="text-input room-code-input" 
                    placeholder="Enter room code"
                    maxlength="6"
                >
                <button id="joinRoomBtn" class="btn-ghost">
                    Join room
                </button>
            </div>
        </div>
        
        <div class="landing-footer text-center">
            <div class="helper-01">Built for the Alien ecosystem</div>
        </div>
    </div>

    <script src="/js/shared.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const createBtn = document.getElementById('createRoomBtn');
            const joinBtn = document.getElementById('joinRoomBtn');
            const roomTitleInput = document.getElementById('roomTitleInput');
            const roomInput = document.getElementById('roomCodeInput');
            
            // Create room handler
            createBtn.addEventListener('click', async () => {
                const title = roomTitleInput.value.trim();
                if (!title) {
                    showToast('Please enter a room title');
                    return;
                }
                
                const speakerWallet = prompt('Enter speaker wallet address:');
                if (!speakerWallet) return;
                
                try {
                    // Get identity
                    const identity = await AlienBridge.getIdentity();
                    
                    // Create room
                    const response = await fetch('/api/rooms', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title,
                            hostId: identity.alienId,
                            speakerWallet
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to create room');
                    }
                    
                    const { roomId } = await response.json();
                    
                    // Redirect to host view
                    window.location.href = `/host.html?room=${roomId}`;
                    
                } catch (error) {
                    console.error('Error creating room:', error);
                    showToast('Failed to create room. Please try again.');
                }
            });
            
            // Join room handler
            joinBtn.addEventListener('click', async () => {
                const roomCode = roomInput.value.trim().toUpperCase();
                if (!roomCode) {
                    showToast('Please enter a room code');
                    return;
                }
                
                try {
                    // Verify room exists
                    const response = await fetch(`/api/rooms/${roomCode}`);
                    if (!response.ok) {
                        throw new Error('Room not found');
                    }
                    
                    // Get identity
                    await AlienBridge.getIdentity();
                    
                    // Redirect to attendee view
                    window.location.href = `/attend.html?room=${roomCode}`;
                    
                } catch (error) {
                    console.error('Error joining room:', error);
                    showToast('Room not found. Please check code and try again.');
                }
            });
            
            // Allow Enter key to join room
            roomInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    joinBtn.click();
                }
            });
            
            // Auto-focus room input when typing
            roomInput.addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
        });
    </script>
</body>
</html>
