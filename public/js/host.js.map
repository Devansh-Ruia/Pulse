{
  "version": 3,
  "sources": ["../../src/host.js"],
  "sourcesContent": ["// Host Dashboard WebSocket Logic\nlet ws = null;\nlet roomId = null;\nlet alienId = null;\nlet sentimentChart = null;\nlet sentimentData = [];\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  try {\n    // Initialize the bridge (gets alienId from JWT or mock)\n    const identity = await window.AlienBridge.init();\n    const alienId = identity.alienId;\n    \n    // Get room ID from URL\n    roomId = getUrlParam('room');\n    if (!roomId) {\n      showToast('No room ID provided');\n      return;\n    }\n\n    // Get elements\n    const roomTitle = document.getElementById('roomTitle');\n    const roomCode = document.getElementById('roomCode');\n    const attendeeCount = document.getElementById('attendeeCount');\n    const totalTips = document.getElementById('totalTips');\n    const totalTipsHeader = document.getElementById('totalTipsHeader');\n    const sentimentGauge = document.getElementById('sentimentGauge');\n    const sentimentLabel = document.getElementById('sentimentLabel');\n    const tipList = document.getElementById('tipList');\n    const roomUrl = document.getElementById('roomUrl');\n\n    try {\n      // Get room info\n      const response = await fetch(`/api/rooms/${roomId}`);\n      if (!response.ok) {\n        throw new Error('Room not found');\n      }\n      const roomInfo = await response.json();\n      roomTitle.textContent = roomInfo.title;\n      roomCode.textContent = roomId.toUpperCase();\n\n      // Generate QR code\n      const baseUrl = window.location.hostname === 'localhost' \n        ? `http://localhost:3000` \n        : window.location.origin;\n      const qrUrl = `${baseUrl}/attend.html?room=${roomId}`;\n      \n      new QRCode(document.getElementById('qr-container'), {\n        text: qrUrl,\n        width: 128,\n        height: 128,\n        colorDark: \"#f4f4f4\",\n        colorLight: \"#393939\",\n        correctLevel: QRCode.CorrectLevel.L\n      });\n\n      // Update room URL\n      roomUrl.textContent = `${window.location.hostname}/attend.html?room=${roomId}`;\n\n      // Initialize chart\n      initializeChart();\n\n      // Create WebSocket connection\n      ws = createWebSocket(\n        roomId,\n        alienId,\n        'host',\n        handleMessage,\n        (status) => {\n          console.log('Connection status:', status);\n        }\n      );\n\n    } catch (error) {\n      console.error('Initialization error:', error);\n      showToast('Failed to load room. Please try again.');\n    }\n\n    function initializeChart() {\n      const ctx = document.getElementById('sentimentChart').getContext('2d');\n      sentimentChart = new Chart(ctx, {\n        type: 'line',\n        data: {\n          labels: [],\n          datasets: [{\n            label: 'Average Sentiment',\n            data: [],\n            borderColor: '#4589ff',\n            borderWidth: 2,\n            tension: 0.1,\n            fill: false\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          animation: { duration: 300 },\n          scales: {\n            y: {\n              min: 0,\n              max: 1,\n              ticks: {\n                stepSize: 0.2,\n                callback: function(value) { return value.toFixed(1); },\n                color: '#c6c6c6',\n                font: { family: 'IBM Plex Mono', size: 12 }\n              },\n              grid: { color: '#525252', drawBorder: false }\n            },\n            x: {\n              ticks: {\n                color: '#c6c6c6',\n                font: { family: 'IBM Plex Mono', size: 12 }\n              },\n              grid: { color: '#525252', drawBorder: false }\n            }\n          },\n          plugins: {\n            legend: { display: false },\n            tooltip: {\n              backgroundColor: '#393939',\n              titleColor: '#f4f4f4',\n              bodyColor: '#c6c6c6',\n              borderColor: '#525252',\n              borderWidth: 1,\n              cornerRadius: 0,\n              titleFont: { family: 'IBM Plex Sans', weight: '600' },\n              bodyFont: { family: 'IBM Plex Mono' }\n            }\n          },\n          elements: {\n            line: { borderColor: '#4589ff', borderWidth: 2, tension: 0.1 },\n            point: { backgroundColor: '#4589ff', radius: 0, hitRadius: 8, hoverRadius: 4 }\n          }\n        }\n      });\n    }\n\n    function handleMessage(message) {\n      switch (message.type) {\n        case 'room_info':\n          // Room info already loaded\n          break;\n          \n        case 'snapshot':\n          updateSentimentChart(message);\n          updateSentimentGauge(message.avg);\n          break;\n          \n        case 'tip_event':\n          updateTips(message.totalTips);\n          addTipToFeed(message);\n          break;\n          \n        case 'user_count':\n          const count = message.count;\n          attendeeCount.textContent = count;\n          // Update people/person text\n          const peopleText = document.querySelector('.dashboard-header .label-01');\n          peopleText.textContent = count === 1 ? ' person' : ' people';\n          break;\n          \n        case 'error':\n          showToast(message.message);\n          break;\n      }\n    }\n\n    function updateSentimentChart(data) {\n      const now = new Date();\n      const timeLabel = now.toLocaleTimeString('en-US', {\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      });\n\n      sentimentData.push({\n        time: timeLabel,\n        value: data.avg,\n        timestamp: data.ts\n      });\n\n      // Keep only last 60 data points (5 minutes)\n      if (sentimentData.length > 60) {\n        sentimentData = sentimentData.slice(-60);\n      }\n\n      // Update chart\n      sentimentChart.data.labels = sentimentData.map(d => d.time);\n      sentimentChart.data.datasets[0].data = sentimentData.map(d => d.value);\n      \n      // Update line color based on current sentiment\n      const currentColor = getSentimentColor(data.avg);\n      sentimentChart.data.datasets[0].borderColor = currentColor;\n      sentimentChart.data.datasets[0].pointBackgroundColor = currentColor;\n      \n      sentimentChart.update('none');\n    }\n\n    function updateSentimentGauge(value) {\n      sentimentGauge.textContent = value.toFixed(2);\n      sentimentGauge.style.color = getSentimentColor(value);\n      \n      // Update label\n      let label = 'Neutral';\n      if (value < 0.2) label = 'Disengaged';\n      else if (value < 0.4) label = 'Not feeling it';\n      else if (value < 0.6) label = 'Neutral';\n      else if (value < 0.8) label = 'Engaged';\n      else label = 'Loving it';\n      \n      sentimentLabel.textContent = label;\n    }\n\n    function updateTips(total) {\n      const formatted = formatCurrency(total);\n      totalTips.textContent = formatted;\n      if (totalTipsHeader) {\n        totalTipsHeader.textContent = formatted;\n      }\n    }\n\n    function addTipToFeed(data) {\n      // Clear \"no tips\" message if present\n      const noTipsMsg = tipList.querySelector('.helper-01');\n      if (noTipsMsg) {\n        noTipsMsg.remove();\n      }\n      \n      const tipItem = document.createElement('div');\n      tipItem.className = 'tip-entry';\n      tipItem.innerHTML = `\n        <span class=\"tip-amount\">${formatCurrency(data.amount)}</span>\n        <span class=\"tip-time\">${formatTime(data.ts)}</span>\n      `;\n      \n      tipList.insertBefore(tipItem, tipList.firstChild);\n      \n      // Keep only last 8 visible tips\n      while (tipList.children.length > 8) {\n        tipList.removeChild(tipList.lastChild);\n      }\n    }\n\n    function getSentimentColor(value) {\n      if (value <= 0.5) {\n        // Blue to white\n        const t = value / 0.5;\n        const r = Math.round(69 + (244 - 69) * t);\n        const g = Math.round(137 + (244 - 137) * t);\n        const b = Math.round(255 + (244 - 255) * t);\n        return `rgb(${r},${g},${b})`;\n      } else {\n        // White to red\n        const t = (value - 0.5) / 0.5;\n        const r = Math.round(244 + (218 - 244) * t);\n        const g = Math.round(244 + (30 - 244) * t);\n        const b = Math.round(244 + (40 - 244) * t);\n        return `rgb(${r},${g},${b})`;\n      }\n    }\n  } catch (error) {\n    console.error('Initialization error:', error);\n    showToast('Failed to load room. Please try again.');\n  }\n});\n"],
  "mappings": "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",
  "names": ["initializeChart", "handleMessage", "updateSentimentChart", "updateSentimentGauge", "updateTips", "addTipToFeed", "getSentimentColor"]
}
