{
  "version": 3,
  "sources": ["../../src/attend.js"],
  "sourcesContent": ["// Attendee WebSocket Logic\nlet ws = null;\nlet roomId = null;\nlet alienId = null;\nlet speakerWallet = null;\nlet currentSentiment = 0.5;\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  try {\n    // Initialize the bridge (gets alienId from JWT or mock)\n    const identity = await window.AlienBridge.init();\n    alienId = identity.alienId;\n    \n    // Get room ID from URL\n    roomId = getUrlParam('room');\n    console.log('Attendee page - room ID from URL:', roomId);\n    console.log('Full URL:', window.location.search);\n    \n    if (!roomId) {\n      showToast('No room ID provided');\n      return;\n    }\n\n    // Get elements\n    const roomTitle = document.getElementById('roomTitle');\n    const sentimentSlider = document.getElementById('sentimentSlider');\n    const sentimentValue = document.getElementById('sentimentValue');\n    const connectionDot = document.getElementById('connectionDot');\n    const tipFeed = document.getElementById('tipFeed');\n    const tipButtons = document.querySelectorAll('.tip-btn');\n\n    try {\n      // Get room info\n      console.log('Fetching room info for:', roomId);\n      const response = await fetch(`/api/rooms/${roomId}`);\n      console.log('Response status:', response.status);\n      \n      if (!response.ok) {\n        throw new Error('Room not found');\n      }\n      const roomInfo = await response.json();\n      roomTitle.textContent = roomInfo.title;\n      speakerWallet = roomInfo.speakerWallet;\n\n      // Create WebSocket connection\n      ws = createWebSocket(\n        roomId,\n        alienId,\n        'attendee',\n        handleMessage,\n        updateConnectionStatus\n      );\n\n      // Throttled sentiment update\n      const sendSentiment = throttle((value) => {\n        if (ws) {\n          ws.send({ type: 'sentiment', value });\n        }\n      }, 500);\n\n      // Sentiment slider handler\n      sentimentSlider.addEventListener('input', (e) => {\n        const value = parseFloat(e.target.value);\n        currentSentiment = value;\n        \n        // Update UI\n        sentimentValue.textContent = value.toFixed(2);\n        \n        // Send to server\n        sendSentiment(value);\n      });\n\n      // Tip button handlers\n      tipButtons.forEach(btn => {\n        btn.addEventListener('click', async () => {\n          const amount = parseFloat(btn.dataset.amount);\n          \n          try {\n            // Request payment\n            const paymentResult = await window.AlienBridge.requestPayment({\n              to: speakerWallet,\n              amount\n            });\n\n            if (paymentResult.success) {\n              // Send tip to server\n              if (ws) {\n                ws.send({\n                  type: 'tip',\n                  amount,\n                  txId: paymentResult.txId\n                });\n              }\n              \n              // Show confirmation\n              showToast(`\u2713 Tipped ${formatCurrency(amount)}!`);\n              \n              // Brief button flash\n              btn.style.background = 'var(--cds-support-success)';\n              btn.style.color = 'var(--cds-text-on-color)';\n              setTimeout(() => {\n                btn.style.background = '';\n                btn.style.color = '';\n              }, 300);\n            }\n          } catch (error) {\n            console.error('Payment error:', error);\n            // Silent fail or subtle message\n          }\n        });\n      });\n\n    } catch (error) {\n      console.error('Initialization error:', error);\n      showToast('Failed to join room. Please try again.');\n    }\n\n    function handleMessage(message) {\n      switch (message.type) {\n        case 'room_info':\n          // Room info already fetched\n          break;\n          \n        case 'snapshot':\n          // Could update average sentiment display if needed\n          break;\n          \n        case 'tip_event':\n          // Add to tip feed\n          addTipToFeed(message.amount);\n          break;\n          \n        case 'user_count':\n          // Could update attendee count if displayed\n          break;\n          \n        case 'error':\n          showToast(message.message);\n          break;\n      }\n    }\n\n    function updateConnectionStatus(status) {\n      connectionDot.className = `connection-dot ${status}`;\n    }\n\n    function addTipToFeed(amount) {\n      // Clear \"no tips\" message if present\n      const noTipsMsg = tipFeed.querySelector('.helper-01');\n      if (noTipsMsg) {\n        noTipsMsg.remove();\n      }\n      \n      const tipItem = document.createElement('div');\n      tipItem.className = 'tip-feed-item';\n      tipItem.innerHTML = `\n        <div class=\"tip-amount\">${formatCurrency(amount)}</div>\n        <div class=\"helper-01\">${formatTime(Date.now())}</div>\n      `;\n      \n      tipFeed.insertBefore(tipItem, tipFeed.firstChild);\n      \n      // Keep only last 10 tips\n      while (tipFeed.children.length > 10) {\n        tipFeed.removeChild(tipFeed.lastChild);\n      }\n      \n      // Remove after 10 seconds\n      setTimeout(() => {\n        if (tipItem.parentNode) {\n          tipItem.remove();\n        }\n      }, 10000);\n    }\n\n    // Initialize sentiment display\n    sentimentValue.textContent = currentSentiment.toFixed(2);\n  } catch (error) {\n    console.error('Initialization error:', error);\n    showToast('Failed to join room. Please try again.');\n  }\n});\n"],
  "mappings": "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",
  "names": ["handleMessage", "addTipToFeed", "updateConnectionStatus"]
}
